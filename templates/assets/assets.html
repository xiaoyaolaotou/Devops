{% extends 'base.html' %}

{% block title %} 首页 {% endblock %}

{% block breadcrunb %}

    <h1>资产信息</h1>

{% endblock %}

<!-- 第一层第一个图标-->
<div class="col-md-3 col-sm-6 col-xs-12">
    <div class="info-box">
        <span class="info-box-icon bg-aqua"><i class="ion ion-ios-gear-outline"></i></span>

        <div class="info-box-content">
            <span class="info-box-text">CPU Traffic</span>
            <span class="info-box-number">90<small>%</small></span>
        </div>
        <!-- /.info-box-content -->
    </div>
    <!-- /.info-box -->
</div>
<!-- /.col -->


{% block content %}
    <div class="row">
        <!-- 第一层第一个图标-->
        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box">
                <span class="info-box-icon bg-aqua"><i class="ion ion-ios-gear-outline"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">主机总数</span>
                    <span class="info-box-number">{{ total }}
                        <small>台</small></span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- /.col -->


        <!-- 第一层第二个图标-->
        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box">
                <span class="info-box-icon bg-red"><i class="fa fa-google-plus"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">Vmware虚拟机</span>
                    <span class="info-box-number">{{ vm }}
                        <small>台</small></span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- /.col -->

        <!-- 第一层第三个图标-->
        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box">
                <span class="info-box-icon bg-green"><i class="ion ion-ios-cart-outline"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">KVM虚拟机</span>
                    <span class="info-box-number">{{ kvm }}
                        <small>台</small></span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- /.col -->

        <!-- 第一层第四个图标-->
        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box">
                <span class="info-box-icon bg-yellow"><i class="ion ion-ios-people-outline"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">用户数</span>
                    <span class="info-box-number">{{ count_user }}</span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- /.col -->
    </div>

    <!-- 搜索 -->
    <form class="form-inline">
        <div class="form-group">
            <div class="input-group">
                <input type="text" class="form-control" id="exampleInputAmount" name="search_username"
                       placeholder="查询主机">
            </div>
        </div>
        <button type="submit" class="btn btn-primary">搜索</button>

    </form>

    <table class="table table-bordered table-hover table-striped">
        <thead>
        <tr>
            <th>#</th>
            <th>主机名</th>
            <th>IP地址</th>
            <th>CPU</th>
            <th>内存</th>
            <th>磁盘</th>
            <th>主机类型</th>
            <th>系统</th>
            <th>创建日期</th>
            <th>更新日期</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        {% for host in object_list %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ host.hostname }}</td>
                <td>{{ host.private_ip }}</td>
                <td>{{ host.cpu }}</td>
                <td>{{ host.server_mem }}</td>
                <td>{{ host.disk }}</td>
                <td>{{ host.server_type }}</td>
                <td>{{ host.os }}</td>
                <td>{{ host.create_time |date:"Y-m-d H:i" }}</td>
                <td>{{ host.update_time |date:"Y-m-d H:i" }}</td>
                <td style="padding: 0; margin: 0">
                    <a type="button" class="btn btn-sm btn-success" href="">编辑</a>
                </td>
                <td style="padding: 0; margin: 0">
                    <button type="button" id="" class="btn btn-sm btn-danger delete-user" data="{{ host.id }}">删除</button>
                </td>

            </tr>
        {% endfor %}
        </tbody>
    </table>



    <!-- 分页 -->
    <div>
        <center>
            <ul class="pagination">
                <li><a href="{#% url 'idc_list' %#}?page=1">首页</a></li>
                {% if page_obj.has_previous %}
                    <li><a href="{#% url 'idc_list' %#}?page={{ page_obj.previous_page_number }}">上一页</a></li>
                {% endif %}

                {% for p in page_obj.paginator.page_range %}

                    {% if p == page_obj.number %}
                        <li class="active"><a href="{#% url 'idc_list' %#}?page={{ p }}">{{ p }}</a></li>
                    {% else %}
                        <li><a href="{#% url 'idc_list' %#}?page={{ p }}">{{ p }}</a></li>
                    {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                    <li><a href="{#% url 'idc_list' %#}?page={{ page_obj.next_page_number }}">下一页</a></li>
                {% endif %}

                <li><a href="{#% url 'idc_list' %#}?page={{ page_obj.paginator.num_pages }}">末页</a></li>
            </ul>
        </center>
    </div>

{% endblock %}


{% block js %}
    <script>
        $(function () {
            $.ajaxSetup({
                beforeSend: function (xhr, settings) {
                    //xhr代指 XMLHttpRequest对象，
                    xhr.setRequestHeader('X-CSRFtoken', $.cookie('csrftoken'));
                }
            });

            // 删除资产信息
            $(".delete-user").click(function () {
                var host_id = $(this).attr("data");
                console.log(host_id)
                $.ajax({
                    url: "{% url "assets:index" %}",
                    type: "delete",
                    data: {"id" : host_id},
                    success: function (res) {
                        if(res.status === 0){
                            swal({
                                "title": "资产删除成功",
                                "text": "",
                                "type": "success"
                            }, function () {
                                setTimeout(function () {
                                    window.location.reload();
                                })
                            })
                        }else {
                            swal("操作失败", res.errmsg, "error");
                        }
                    }
                })
            });

        })

    </script>
{% endblock %}

